import{j as e,I as M,n as u}from"./index.CFX3P5ff.js";import{r as n}from"./index.DhYZZe0J.js";function K(){n.useState(!1);const[j,m]=n.useState(""),[a,h]=n.useState(!1),[T,w]=n.useState(""),[y,x]=n.useState(""),[U,C]=n.useState(!1),[s,N]=n.useState(""),[R,g]=n.useState("cinemeta"),[p,$]=n.useState(),l=n.useRef(null),b=n.useRef(null),I=n.useRef(null),f=n.useRef(null);n.useEffect(()=>{const o=new URLSearchParams(window.location.search).get("id")??"";if(o){h(!0);const i=window.location.origin.includes(":4321")?"http://localhost:3030":window.location.origin;fetch(`${i}/getConfig/${encodeURIComponent(o)}`).then(t=>t.json()).then(t=>{if(!t)throw new Error("No config found");$(t),x(t.catalogName),C(t.ignoreUnreleased);const v=encodeURIComponent(`${t.path}${t.catalogName?`|cn=${t.catalogName}`:""}${t.ignoreUnreleased?"|iu":""}`);w(`${i}/${v}/manifest.json`)}).catch(t=>{console.warn(t)}).finally(()=>{h(!1)})}},[]);async function S(){const r=window.location.origin.includes(":4321")?"http://localhost:3030":window.location.origin;try{const o=await fetch(`${r}/recommend`,{headers:{"cache-control":"no-cache"}});if(!o.ok)throw new Error(`Failed to fetch list page: ${o.statusText}`);const t=`https://letterboxd.com${await o.json()}`;m(t),l.current&&(l.current.value=t),N("")}catch(o){console.warn(o)}}function c(){l.current?.value?m(l.current.value):m("")}function d(){b.current?.value?x(b.current.value):x("")}function L(){if(f.current?.value)switch(f.current.value){case"cinemeta":case"letterboxd":case"rpdb":g(f.current.value);break;default:g("cinemeta")}else g("cinemeta")}async function k(){const r=window.location.origin.includes(":4321")?"http://localhost:3030":window.location.origin;try{const o=JSON.stringify({url:j,base:r,posters:I.current?.checked,customListName:y.length?y:void 0,ignoreUnreleased:U,posterChoice:R});console.log({toVerify:o});const i=await fetch(`${r}/verify/${btoa(o)}`,{headers:{"Content-Type":"application/json"},cache:"no-cache"});if(!i.ok){const v=await i.json();u.error(v);return}const t=await i.json();console.log({manifestUrl:t}),N(t)}catch(o){u.error(`Try again in a few seconds: ${o.message}`)}}async function P(){if(c(),w(""),j.length===0){u.error("Please enter a valid URL");return}h(!0),await k(),s.length&&w(s),h(!1)}async function V(){try{await navigator.clipboard.writeText(s),u.success("Copied, paste in Stremio!")}catch(r){u.error(r.message)}}async function A(){window.location.href=s}return e.jsxs("div",{children:[e.jsx(M,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[e.jsx("div",{className:"text-base",children:"A Letterboxd URL containing a list of posters (including any sorting!):"}),e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx("input",{type:"text",placeholder:"https://letterboxd.com/almosteffective/watchlist",className:"w-full border border-black text-tailwind rounded text-xl px-2 py-1",ref:l,onPaste:c,onKeyDown:c,onKeyUp:c,onBlur:c,onFocus:c,defaultValue:p?.path?`https://letterboxd.com${decodeURIComponent(p.path)}`:""}),e.jsx("button",{className:"grow border border-white bg-white uppercase text-tailwind text-lg p-2 rounded font-bold hover:bg-tailwind hover:text-white hover:underline",onClick:S,disabled:a,type:"button",children:a===!1?"Recommend":"Validating..."})]}),e.jsx("div",{className:"text-base",children:"Set a custom list if you'd like (leave empty to auto-generate):"}),e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"My Cool List Name",className:"w-full border border-black text-tailwind rounded text-xl px-2 py-1",ref:b,onPaste:d,onKeyDown:d,onKeyUp:d,onBlur:d,onFocus:d,defaultValue:p?.catalogName?`${decodeURIComponent(p.catalogName)}`:""})}),e.jsxs("div",{children:["What posters do you want to use?",e.jsxs("select",{className:"border border-black text-tailwind rounded text-xl px-2 py-1",ref:f,onChange:L,children:[e.jsx("option",{value:"cinemeta",children:"Cinemeta (default)"}),e.jsx("option",{value:"letterboxd",children:"Letterboxd"}),e.jsx("option",{value:"rpdb",children:"RPDB"})]})]}),e.jsxs("div",{className:"grid gap-1 grid-cols-2 grid-rows-2",children:[e.jsx("button",{className:"col-span-2 grow border border-white bg-white uppercase text-tailwind text-lg p-2 rounded font-bold hover:bg-tailwind hover:text-white hover:underline",onClick:P,disabled:a,type:"button",children:a===!1?"Generate Manifest":"Validating..."}),e.jsx("button",{className:"grow border border-white bg-white uppercase text-tailwind text-lg p-2 rounded font-bold hover:bg-tailwind hover:text-white hover:underline",onClick:A,hidden:a||s.length===0,type:"button",children:a===!1?"Install":"Validating..."}),e.jsx("button",{className:"grow border border-transparent hover:border-white bg-tailwind uppercase text-white text-lg p-2 rounded font-normal",onClick:V,hidden:a||s.length===0,type:"submit",children:a===!1?"Copy":"Validating..."})]}),e.jsxs("div",{className:"hidden",children:[e.jsx("div",{children:e.jsx("a",{href:s,children:s})}),e.jsx("div",{children:window.navigator.userActivation.hasBeenActive?"User has been active":"User has not been active"}),e.jsx("div",{children:window.navigator.userActivation.isActive?"User is active":"User is not active"})]})]})]})}export{K as default};
